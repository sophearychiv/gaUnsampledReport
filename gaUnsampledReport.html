<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1561.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 20.0px; font: 12.0px Menlo; color: #22863a; -webkit-text-stroke: #22863a}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: right; line-height: 20.0px; font: 12.0px Menlo; color: #1b1f23; color: rgba(27, 31, 35, 0.3); -webkit-text-stroke: rgba(27, 31, 35, 0.3); min-height: 14.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 20.0px; font: 12.0px Menlo; color: #24292e; -webkit-text-stroke: #24292e}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 20.0px; font: 12.0px Menlo; color: #6f42c1; -webkit-text-stroke: #6f42c1}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 20.0px; font: 12.0px Menlo; color: #24292e; -webkit-text-stroke: #24292e; min-height: 14.0px}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 20.0px; font: 12.0px Menlo; color: #032f62; -webkit-text-stroke: #032f62}
    span.s1 {font-kerning: none; color: #24292e; -webkit-text-stroke: 0px #24292e}
    span.s2 {font-kerning: none}
    span.s3 {font-kerning: none; color: #6f42c1; -webkit-text-stroke: 0px #6f42c1}
    span.s4 {font-kerning: none; color: #22863a; -webkit-text-stroke: 0px #22863a}
    span.s5 {font-kerning: none; color: #032f62; -webkit-text-stroke: 0px #032f62}
    span.s6 {font-kerning: none; color: #005cc5; -webkit-text-stroke: 0px #005cc5}
    span.Apple-tab-span {white-space:pre}
    table.t1 {background-color: #ffffff; border-collapse: collapse}
    td.td1 {width: 128.4px; padding: 0.0px 10.0px 0.0px 10.0px}
    td.td2 {width: 128.4px; min-width: 50.0px; padding: 0.0px 10.0px 0.0px 10.0px}
    td.td3 {width: 764.1px; padding: 0.0px 10.0px 0.0px 10.0px}
  </style>
</head>
<body>
<table cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="top" class="td1">
        <p class="p1"><span class="s1">&lt;!</span><span class="s2">doctype</span><span class="s1"> </span><span class="s3">html</span><span class="s1">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p3"><span class="s2">&lt;</span><span class="s4">html</span><span class="s2"> </span><span class="s3">lang</span><span class="s2">=</span><span class="s5">"en"</span><span class="s2">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p1"><span class="s1">&lt;</span><span class="s2">head</span><span class="s1">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p4"><span class="s1"><span class="Apple-tab-span">	</span>&lt;</span><span class="s4">meta</span><span class="s1"> </span><span class="s2">charset</span><span class="s1">=</span><span class="s5">"UTF-8"</span><span class="s1">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p3"><span class="s2"><span class="Apple-tab-span">	</span>&lt;</span><span class="s4">title</span><span class="s2">&gt;Upload&lt;/</span><span class="s4">title</span><span class="s2">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p1"><span class="s1">&lt;/</span><span class="s2">head</span><span class="s1">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p1"><span class="s1">&lt;</span><span class="s2">body</span><span class="s1">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p3"><span class="s2"><span class="Apple-tab-span">	</span>&lt;?php</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p3"><span class="s2"><span class="Apple-tab-span">	</span>if($_FILES['image']['tmp_name']){</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p3"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>move_uploaded_file($_FILES['image']['tmp_name'], '/test/images/'.rand(1, 1000).'.jpg');</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p3"><span class="s2"><span class="Apple-tab-span">	</span>}</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p3"><span class="s2"><span class="Apple-tab-span">	</span>?&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p6"><span class="s1"><span class="Apple-tab-span">	</span>&lt;</span><span class="s4">form</span><span class="s1"> </span><span class="s3">enctype</span><span class="s1">=</span><span class="s2">"multipart/form-data"</span><span class="s1"> </span><span class="s3">method</span><span class="s1">=</span><span class="s2">"POST"</span><span class="s1">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p6"><span class="s1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>&lt;</span><span class="s4">input</span><span class="s1"> </span><span class="s3">type</span><span class="s1">=</span><span class="s2">"file"</span><span class="s1"> </span><span class="s3">name</span><span class="s1">=</span><span class="s2">"image"</span><span class="s1">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p4"><span class="s1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>&lt;</span><span class="s4">input</span><span class="s1"> </span><span class="s2">type</span><span class="s1">=</span><span class="s5">"button"</span><span class="s1"> </span><span class="s2">onclick</span><span class="s1">=</span><span class="s5">"</span><span class="s2">upload</span><span class="s1">(</span><span class="s6">this</span><span class="s1">)"&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p3"><span class="s2"><span class="Apple-tab-span">	</span>&lt;/</span><span class="s4">form</span><span class="s2">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p6"><span class="s1"><span class="Apple-tab-span">	</span>&lt;</span><span class="s4">form</span><span class="s1"> </span><span class="s3">enctype</span><span class="s1">=</span><span class="s2">"multipart/form-data"</span><span class="s1"> </span><span class="s3">method</span><span class="s1">=</span><span class="s2">"POST"</span><span class="s1">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p6"><span class="s1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>&lt;</span><span class="s4">input</span><span class="s1"> </span><span class="s3">type</span><span class="s1">=</span><span class="s2">"file"</span><span class="s1"> </span><span class="s3">name</span><span class="s1">=</span><span class="s2">"image"</span><span class="s1">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p4"><span class="s1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>&lt;</span><span class="s4">input</span><span class="s1"> </span><span class="s2">type</span><span class="s1">=</span><span class="s5">"button"</span><span class="s1"> </span><span class="s2">onclick</span><span class="s1">=</span><span class="s5">"</span><span class="s2">upload</span><span class="s1">(</span><span class="s6">this</span><span class="s1">)"&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p3"><span class="s2"><span class="Apple-tab-span">	</span>&lt;/</span><span class="s4">form</span><span class="s2">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p1"><span class="s1"><span class="Apple-tab-span">	</span>&lt;</span><span class="s2">script</span><span class="s1">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p3"><span class="s2">var LOG_SHEET_NAME = 'Unsampled Report Logs';</span></p>
        <p class="p3"><span class="s2">var ss = SpreadsheetApp.getActive();</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2">//var ui = SpreadsheetApp.getUi();</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2">function requestReport() {</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var ss = SpreadsheetApp.getActive();</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var reportConfigSheet = ss.getSheetByName('Report Configuration');</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var t =2;</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var numberOfColumns = reportConfigSheet.getRange("C1").getValue();</span></p>
        <p class="p5"><span class="s2"><span class="Apple-converted-space"> </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>//adding more columns<span class="Apple-converted-space"> </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>for (var i=1; i&lt;=numberOfColumns; i++){</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var startDateRange = reportConfigSheet.getRange(5,t);<span class="Apple-converted-space"> </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var startDate = startDateRange.getValue();</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var endDateRange = reportConfigSheet.getRange(6,t);<span class="Apple-converted-space"> </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var endDate = endDateRange.getValue();</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var metricsRange = reportConfigSheet.getRange(8,t);<span class="Apple-converted-space"> </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var metrics = metricsRange.getValue();</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var dimensionsRange = reportConfigSheet.getRange(9,t);<span class="Apple-converted-space"> </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var dimensions = dimensionsRange.getValue();</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var filtersRange = reportConfigSheet.getRange(11,t);<span class="Apple-converted-space"> </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var filters = filtersRange.getValue();</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var titleRange = reportConfigSheet.getRange(2,t);<span class="Apple-converted-space"> </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var title = titleRange.getValue();</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var sortRange = reportConfigSheet.getRange(10,t);<span class="Apple-converted-space"> </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var sort = sortRange.getValue();</span></p>
        <p class="p5"><span class="s2"><span class="Apple-converted-space">  </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">   </span>if (title != "" | startDate != "" | endDate != "" | metrics != "" | dimensions != "" ){</span></p>
        <p class="p5"><span class="s2"><span class="Apple-converted-space">   </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var resource = {</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>'title': title,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>'start-date': startDate,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>'end-date': endDate,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>'metrics': metrics,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>'dimensions': dimensions,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>'sort': sort,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>'filters': filters</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">      </span>};</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">   </span>var ss = SpreadsheetApp.getActive();</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">   </span>var reportConfigSheet = ss.getSheetByName('Report Configuration');</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">   </span>var accountId = reportConfigSheet.getRange(18,t).getValue();</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">   </span>var webPropertyId = reportConfigSheet.getRange(19,t).getValue();</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">   </span>var profileId = reportConfigSheet.getRange(20,t).getValue();</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>try {</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>var request = Analytics.Management.UnsampledReports.insert(resource, accountId, webPropertyId, profileId);</span></p>
        <p class="p5"><span class="s2"><span class="Apple-converted-space">    </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>} catch (error) {</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>ui.alert('Error Performing Unsampled Report Query', error.message, ui.ButtonSet.OK);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>return;</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>}</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var sheet = ss.getSheetByName(LOG_SHEET_NAME);</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>if (!sheet) {</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>sheet = ss.insertSheet(LOG_SHEET_NAME);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>sheet.appendRow(['User', 'Account', 'Web Property', 'View', 'Title', 'Inserted Time', 'Updated Time', 'Status', 'Id', 'File']);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>sheet.getRange(1, 1, 1, 10).setFontWeight('bold');</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>}</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>sheet.appendRow([</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>Session.getEffectiveUser().getEmail(),</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>request.accountId,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>request.webPropertyId,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>request.profileId,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>request.title,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>request.created,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>request.updated,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>request.status,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>request.id</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>]);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space"> </span>t++;</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>}else{</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>var failRecords = "Some reports were not run. Please make sure all the fields are correct."</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>Browser.msgBox(failRecords);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>}</span></p>
        <p class="p5"><span class="s2"><span class="Apple-converted-space">  </span></span></p>
        <p class="p3"><span class="s2">}</span></p>
        <p class="p5"><span class="s2"><span class="Apple-converted-space">  </span></span></p>
        <p class="p3"><span class="s2">}</span></p>
        <p class="p5"><span class="s2"><span class="Apple-converted-space"> </span></span></p>
        <p class="p3"><span class="s2">// Scans LOG_SHEET_NAME and tries to update any report that is PENDING</span></p>
        <p class="p3"><span class="s2">function updateAllReports() {</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var sheet = ss.getSheetByName(LOG_SHEET_NAME);</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var lastRow = sheet.getLastRow();</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var dataRange = sheet.getRange(2,1, lastRow, 10);</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var data = dataRange.getValues();</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>for (var i=0; i&lt;data.length; i++) {</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>// If data is PENDING let's try to update it's status. Hopefully it's complete now</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>// but it may take up to 24h to process an Unsampled Reprot</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>if (data[i][0] == Session.getEffectiveUser().getEmail() &amp;&amp; data[i][7] == 'PENDING') {</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">      </span>try {</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">      </span>var request = Analytics.Management.UnsampledReports.get(data[i][1], data[i][2], data[i][3], data[i][8]);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">      </span>} catch (error) {</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>ui.alert('Error Performing Unsampled Report Query', error.message, ui.ButtonSet.OK);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>return;</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">      </span>}</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">      </span>data[i] = [</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>Session.getEffectiveUser().getEmail(),</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>request.accountId,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>request.webPropertyId,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>request.profileId,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>request.title,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>request.created,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>request.updated,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>request.status,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>request.id,</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>request.status == 'COMPLETED' ? DriveApp.getFileById(request.driveDownloadDetails.documentId).getUrl() : ''</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">      </span>];</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">      </span>// If data is Complete let's import it into a new sheet</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">      </span>if (request.status == 'COMPLETED') {</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">        </span>importReportFromDrive(request.title, request.driveDownloadDetails.documentId);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">      </span>}</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>}</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>}</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>// Write only once to the spreadsheet this is faster</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>dataRange.setValues(data);</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2">}</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2">function importReportFromDrive(title, fileId) {</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var file = DriveApp.getFileById(fileId);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var csvString = file.getBlob().getDataAsString();</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var data = Utilities.parseCsv(csvString);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>var ss = SpreadsheetApp.getActiveSpreadsheet();</span></p>
        <p class="p5"><span class="s2"></span><br></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>// Check if the sheet already exists</span></p>
        <p class="p5"><span class="s2"><span class="Apple-converted-space">  </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>if (ss.getSheetByName(title)==null){</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>var i=1;</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>var sheetName = title;</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>while (ss.getSheetByName(sheetName)) {</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">      </span>sheetName = title + ' ('+ i++ +')';</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>}</span></p>
        <p class="p5"><span class="s2"><span class="Apple-converted-space">    </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>var sheet = ss.insertSheet(sheetName);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>var range = sheet.getRange(2, 1, data.length, data[0].length);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>range.setValues(data);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>//sheet.insertRows(1);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>var date = Utilities.formatDate(new Date(), "PST", "MM/dd/yyyy '@' hh:mm a");</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>sheet.getRange("A1").setValue("Last updated: " +date);</span></p>
        <p class="p5"><span class="s2"><span class="Apple-converted-space">    </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>}else{</span></p>
        <p class="p5"><span class="s2"><span class="Apple-converted-space"> </span></span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>var dataSheet = ss.getSheetByName(title);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>dataSheet.clear();</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>var range = dataSheet.getRange(2, 1, data.length, data[0].length);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>range.setValues(data);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>//dataSheet.insertRows(1);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>var date = Utilities.formatDate(new Date(), "PST", "MM/dd/yyyy '@' hh:mm a");</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">    </span>dataSheet.getRange("A1").setValue("Last updated: " +date);</span></p>
        <p class="p3"><span class="s2"><span class="Apple-converted-space">  </span>}</span></p>
        <p class="p5"><span class="s2"><span class="Apple-converted-space">  </span></span></p>
        <p class="p3"><span class="s2">}<span class="Apple-tab-span">	</span></span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"><span class="Apple-tab-span">	</span></span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p5"><span class="s2"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p1"><span class="s1"><span class="Apple-tab-span">	</span>&lt;/</span><span class="s2">script</span><span class="s1">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p1"><span class="s1">&lt;/</span><span class="s2">body</span><span class="s1">&gt;</span></p>
      </td>
    </tr>
    <tr>
      <td valign="top" class="td2">
        <p class="p2"><span class="s2"></span><br></p>
      </td>
      <td valign="top" class="td3">
        <p class="p1"><span class="s1">&lt;/</span><span class="s2">html</span><span class="s1">&gt;</span></p>
      </td>
    </tr>
  </tbody>
</table>
</body>
</html>
